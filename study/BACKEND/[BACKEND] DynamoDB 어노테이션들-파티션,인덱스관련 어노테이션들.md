# DynamoDB 어노테이션들

DynamoDB에서 사용하는 어노테이션들을 요약해보면 아래와 같다.<br>

필드를 표현하는 어노테이션

- DynamoDBAttribute

<br>

기본키  또는 인덱싱 관련 어노테이션들

- DynamoDBAutoGeneratedKey
- DynamoDBHashKey
- DynamoDBIndexHashKey
- DynamoDBIndexRangeKey
- DynamoDBRangeKey

<br>

문서를 나타내는 속성

- DynamoDBDocument

- 참고) 몽고DB 같은 경우에도 Document라는 용어가 나온다. 보통 nosql 쪽에서는 하나의 클래스로 표현할 수 있으면서 테이블과 비슷한 역할을 하는 것을 Document라고 했었다.

<br>

낙관적 락에 관련된 어노테이션

- DynamoDBVersionAttribute



# 참고자료

> - [DynamoDB에 사용되는 JAVA 주석](https://docs.aws.amazon.com/ko_kr/amazondynamodb/latest/developerguide/DynamoDBMapper.Annotations.html)
> - [DynamoDB의 Table, Item, Attribute, Primary Key, Secondary Index](https://github.com/soon-good/kr-stock-calculator/blob/main/study/BACKEND/%5BBACKEND%5D-DynamoDB%EC%9D%98%20Table%2C%20Item%2C%20Attribute%2C%20Primary%20Key%2C%20Secondary%20Index%2C%20DynamoDB%20Streams.md)
> - [DynamoDB의 GSI (Global Secondary Index)](https://github.com/soon-good/kr-stock-calculator/blob/main/study/BACKEND/%5BBACKEND%5D%20DynamoDB%20GSI%20(Global%20Secondary%20Index).md)
> - [DynamoDB의 LSI (Local Secondary Index)](https://github.com/soon-good/kr-stock-calculator/blob/main/study/BACKEND/%5BBACKEND%5D%20DynamoDB%20LSI%20(Local%20Secondary%20Index).md)

<br>

# 필드를 표현하는 어노테이션

## DynamoDBAttribute

클래스의 속성을 테이블의 속성으로 매핑한다. 공식문서에서 속성이라고 이야기하는 이유는, 필드에 지정해도 되고 getter/setter 에 모두 적용가능하기 때문이다. 테이블의 컬럼명이 클래스의 필드 명과 다를 경우에는 `@DynamoDBAttribute` 어노테이션의 attribuetName 에 필드명을 테이블의 어떤 어트리뷰트(컬럼)에 매핑할지를 명시해준다.<br>

아래 예제를 보자. 공식문서의 [예제](https://docs.aws.amazon.com/ko_kr/amazondynamodb/latest/developerguide/DynamoDBMapper.Annotations.html)다.`bookAuthors` 라는 클래스의 필드를 다이나모디비의 `Authors` 라는 필드에 매핑하고 있다. 그리고 필드에 바로 어노테이션을 사용하는 것이 아니라 getter에 지정하고 있다. 물론 필드에 바로 어노테이션을 지정하는 것 역시 가능하다.<br>

```java
@DynamoDBAttribute(attributeName = "Authors")
public List<String> getBookAuthors() { return BookAuthors; }
public void setBookAuthors(List<String> BookAuthors) { this.BookAuthors = BookAuthors; }
```

<br>

## DynamoDBTyped

DynamoDB에서 지원하는 자료형이 아닐 경우에 사용하는 어노테이션. 예를 들면 LocalDateTime 은 DynamoDB에서 지원되지 않는 타입이다. 이때 DynamoDBTyped와 DynamoDBConverted 를 함께 사용해서 변환작업을 해준다.<br>

<br>

## DynamoDBTypeConverted

DynamoDB에서 지원하는 자료형이 아닐 경우에 사용하는 어노테이션. 예를 들면 LocalDateTime 은 DynamoDB에서 지원되지 않는 타입이다. 이때 DynamoDBTyped와 DynamoDBConverted 를 함께 사용해서 변환작업을 해준다.<br>

<br>

# 기본키  또는 인덱싱 관련 어노테이션들

## DynamoDBAutoGeneratedKey

파티션키 or 정렬 키 속성을 자동 생성되게끔 지정하는 어노테이션.<br>

`DynamoDBMapper` 는 이런 속성을 지정할 때  [UUID](http://docs.oracle.com/javase/6/docs/api/java/util/UUID.html) 를 생성한다.<br>

<br>

아래 예제를 보면 `@DynamoDBHashKey` 와 함께 `@DynamoDBAutoGeneratedKey` 를 함께 사용하고 있다.

```java
@DynamoDBTable(tableName="AutoGeneratedKeysExample")
public class AutoGeneratedKeys {
    private String id;
    private String payload;

    @DynamoDBHashKey(attributeName = "Id")
    @DynamoDBAutoGeneratedKey
    public String getId() { return id; }
    public void setId(String id) { this.id = id; }

    @DynamoDBAttribute(attributeName="payload")
    public String getPayload() { return this.payload; }
    public void setPayload(String payload) { this.payload = payload; }

    public static void saveItem() {
        AutoGeneratedKeys obj = new AutoGeneratedKeys();
        obj.setPayload("abc123");

        // id field is null at this point
        DynamoDBMapper mapper = new DynamoDBMapper(dynamoDBClient);
        mapper.save(obj);

        System.out.println("Object was saved with id " + obj.getId());
    }
}
```

<br>

## DynamoDBHashKey

> 한글 문서는 번역이 조금 어수선해서 이해가 힘들어서 이 부분은 원서를 참고했다.

`DynamoDBHashKey` 어노테이션이 명시된 클래스의 속성(클래스의 필드)를 테이블의 파티션 키로 매핑한다.<br>

스칼라 문자열, 숫자, 불리언 타입을 지정할 수 있다.<br>

<br>

```java
@DynamoDBTable(tableName="ProductCatalog")
public class CatalogItem {
    private Integer Id;
   @DynamoDBHashKey(attributeName="Id")
   public Integer getId() {
        return Id;
   }
   public void setId(Integer Id) {
        this.Id = Id;
   }
   // Additional properties go here.
}
```

<br>

## DynamoDBIndexHashKey

Global Secondary Index 의 파티션 키로 매핑한다. 스칼라문자열, 숫자, 불리언 타입을 지정할 수 있다.<br>

<br>

## DynamoDBIndexRangeKey

Global Secondary Index 또는 Local Secondary Index 의 정렬키(sort key)로 매핑한다. 스칼라 문자열, 숫자, 불리언 타입을 지정할 수 있다. 만약 클래스 속성 이름과 인덱스의 정렬 키의 이름이 다르면 인덱스 속성이름(attributeName)도 지정해줘야 한다.<br>

<br>

## DynamoDBRangeKey

클래스의 속성(필드,메서드)을 테이블의 정렬 키 속성으로 매핑한다. 스칼라문자열, 숫자, 불리언 타입을 지정할 수 있다. <br>

Partition And Sort Key (복합키)를 기본키로 하고 있을 경우, Sort Key 에 대해서 `@DynamoDBRangeKey` 를 지정해서 정렬키롤 매핑한다<br>

아래는 Reply 클래스를 Reply 테이블에 매핑하는 코다다. `@DynamoDBHashKey` , `@DynamoDBRangeKey` 태그를 사용해 테이블의 기본키에 매핑하고 있다.<br>

<br>

```java
@DynamoDBTable(tableName="Reply")
public class Reply {
    private Integer id;
    private String replyDateTime;

    @DynamoDBHashKey(attributeName="Id")
    public Integer getId() { return id; }
    public void setId(Integer id) { this.id = id; }

    @DynamoDBRangeKey(attributeName="ReplyDateTime")
    public String getReplyDateTime() { return replyDateTime; }
    public void setReplyDateTime(String replyDateTime) { this.replyDateTime = replyDateTime; }

   // Additional properties go here.
}
```

<br>

# 문서를 나타내는 속성

## DynamoDBTable

다이나모 디비의 테이블을 클래스에 매핑할 때 사용한다. 

```java
@DynamoDBTable(tableName="People")
public class Developer { ...} 
```

<br>

**`@DynamoDBTable` 주석은 상속이 가능하다.**<br>

예를 들면 `Developer` 테이블을 상속받는 `Lead` 클래스가 있다고 해보자. 이때 `Lead` 클래스도 `People` 테이블로 매핑된다. 왜냐하면, 부모클래스인 `Developer` 가 `People` 클래스를 상속하고 있기 때문이다.<br>

<br>

**`@DynamoDBTable` 또한 재정의가 가능하다.**<br>

`Developer` 클래스에서 상속되는 새 클래스인 `Lead` 클래스에 `@DynamoDBTable` 을 직접 선언해서 다른 클래스로 매핑되도록 명시적으로 매핑하는 것이 가능하다.<br>

```java
@DynamoDBTable(tableName="Managers")
public class Manager extends Developer { ...} 
```

<br>

# 낙관적 락에 관련된 어노테이션

## DynamoDBVersionAttribute

낙관적 잠금 버전 번호를 저장하는 클래스 속성을 식별한다. 자세한 내용은  [버전 번호를 이용한 낙관적 잠금](https://docs.aws.amazon.com/ko_kr/amazondynamodb/latest/developerguide/DynamoDBMapper.OptimisticLocking.html) 을 참고하자.



